
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bootstrap, from Twitter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="../assets/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
      
       text {
            font-family: sans-serif;
         }
         
         .axis path,
			.axis line {
				fill: none;
				stroke: grey;
				shape-rendering: crispEdges;
			}
			
			.axis text {
				font-size: 11px;
			}
         
         #button {
            cursor: pointer;
         }
         
         #button rect {
            height: 30px;
            width: 110px;
            fill: white;
            stroke: grey;
         }
         
         #button text {
            font-size: 18px;
         }
         
         .info rect {
            height: 50px;
            width: 150px;
            fill: white;
            stroke: pink;
         }
         
         .info text {
            font-size: 15px;
         }

    </style>
    
    
    <link href="../assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="../assets/ico/favicon.png">
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="#">Project name</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <li><a href="#about">About</a></li>
              <li><a href="#contact">Contact</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

   <div id="chart"></div>
       <!-- /container -->
    
    
     
<script src="d3/d3.v3.js"></script>
        <script>
     (function(d3) {
            'use strict';


         var rows = 10;
         var cols = 10;
         
       var margin = {top: 20, right: 10, bottom: 20, left: 10}
  , w = parseInt(d3.select('#chart').style('width'), 10)
  , w = w - margin.left - margin.right, 
  h = parseInt(d3.select('#chart').style('height'), 10), 
  h = h - margin.top - margin.bottom; 
  
         var padding = 10;
         
         var svg = d3.select("#chart")
                     .append("svg")
                     .attr("width", w + margin.left + margin.right)
                     .attr("height", h + margin.top + margin.bottom)
                     .append("g")
                     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                     
         var xScaleRandom = d3.scale.ordinal()
                                    .domain(d3.range(cols))
                                    .rangeRoundBands([padding, w - padding]);             
         var xScaleRank = d3.scale.linear()
                              .domain([0, 1])
                              .range([padding, w - padding]);
  
  var button = svg.append("g")
                         .attr("id", "button");                 
         button.append("rect")
               .attr("x", padding)
               .attr("y", 0);   
         button.append("text")
               .text("Sort by risk")
               .attr("x", padding + 55)
               .attr("y", 20)
               .attr("text-anchor", "middle");
            

d3.csv("test_model.csv",  function(error, data){
   
   data.forEach(function(d) {
    d.risk = +d.risk;
    d.disease = +d.disease;
  });
  
  //console.log(data);
 

  var people = data.length;
         var cancerNumber = 0;
          for (var k = 0; k < people; k++) {
            if(data[k].disease == 1){
              cancerNumber++; 
            }
          }
     //    for (var i = 0; i < people; i++) {
    //     	if(i < cancerNumber){
    //   		risk.push(Math.random());
    //     	}else{
  //       		risk.push(Math.random() + .1)
  //       	}
         	
  //       };
         
                          
         svg.selectAll("circle")
            .data(data)
            .enter()
            .append("circle")
            .attr("cx", function(d) {
               return xScaleRandom(d.risk);
            })
            .attr("cy", function(d, i) {
               var nearest = Math.ceil((i + 1)/ cols);  //Indexing starts from 0 ya dingus
               return nearest * ((h - padding) / rows);
            })
            .attr("r", 7)
            .attr("fill", function(d, i) {
               if (d.disease == 1) {
                  return "crimson";
               }
               else {
                  return "lightblue";
               }
            });
            
       var xAxis = d3.svg.axis()
                           .scale(xScaleRank);
     
       svg.append("g")
            .call(xAxis)
            .attr("transform", "translate (0, " + (h / 2 + padding) + ")")
            .attr("class", "axis")
            .style("opacity", 0);
     
                    
         var stacks = [];
         
         for (var j = 0; j < people; j++) {
            var round1 = Math.round(data[j].risk/ 0.025);
            stacks.push(0);
            for (var jj = j - 1; jj >= 0; jj--) {
               var round2 = Math.round(data[jj].risk / 0.025);
               if (round1 == round2) {
                  stacks[j] = stacks[jj] + 1;
                  break;
               }
            }
         }
         
         svg.append("rect")
            .attr("id", "mover");
         
         d3.select("#button")
            .on("click", function() {
               svg.select("#button")
                  .remove();
               
         svg.select(".axis")
                  .transition()
                  .duration(1000)
                  .style("opacity", 1);
                  
         svg.selectAll("circle")
                  .transition()
                  .duration(2000)
                  .attr("cx", function(d) {
                     return xScaleRank(Math.round(d.risk / 0.025) * 0.025);
                  })
                  .attr("cy", function(d, i) {
                     return (h / 2) - (stacks[i] * 20);
                  });
                  
           svg.on("mousemove", function(d) {
                  var mouseX = d3.event.x;
                  svg.select("rect#mover")
                     .attr("x", mouseX)
                     .attr("y", 0)
                     .attr("width", w - (mouseX))
                     .attr("height", h / 2 + 10)
                     .attr("fill", "pink")
                     .style("opacity", 0.3);
                     
               var truePos = 0;
               var falsePos = 0;
                     
               for (var k = 0; k < people; k++) {
                  if (xScaleRank(Math.round(data[k].risk / 0.025)) * 0.025 >= mouseX) {
                     if (k < cancerNumber) {
                        truePos++;
                     }
                     else {
                        falsePos++;
                     }
                  }
               };
               
               var trueNeg = people - cancerNumber - falsePos;
               var falseNeg = cancerNumber - truePos;
               
               var sensitivity = svg.append("g")
                             .attr("class", "info");
               sensitivity.append("text")
                   .text("Sensitivity")
                   .attr("x", padding + 75)
                   .attr("y", 0.65 * h - 15)
                   .attr("text-anchor", "middle");
               sensitivity.append("rect")
                   .attr("x", padding)
                   .attr("y", 0.65 * h);
               sensitivity.append("text")
                   .text(Math.round(truePos / cancerNumber * 100) + "%")
                   .attr("x", padding + 75)
                   .attr("y", 0.65 * h + 30)
                   .attr("text-anchor", "middle");
               
               var specificity = svg.append("g")
                             .attr("class", "info");
               specificity.append("text")
                   .text("Specificity")
                   .attr("x", padding + 150 + padding + 75)
                   .attr("y", 0.65 * h - 15)
                   .attr("text-anchor", "middle");
               specificity.append("rect")
                   .attr("x", padding + 150 + padding)
                   .attr("y", 0.65 * h);
               specificity.append("text")
                   .text(Math.round(trueNeg / (people - cancerNumber) * 100) + "%")
                   .attr("x", padding + 150 + padding + 75)
                   .attr("y", 0.65 * h + 30)
                   .attr("text-anchor", "middle");
                   
               var ppv = svg.append("g")
                             .attr("class", "info");
               ppv.append("text")
                   .text("PPV")
                   .attr("x", padding + 75)
                   .attr("y", 0.85 * h - 15)
                   .attr("text-anchor", "middle");
               ppv.append("rect")
                   .attr("x", padding)
                   .attr("y", 0.85 * h);
               ppv.append("text")
                   .text(Math.round(truePos / (truePos + falsePos) * 100) + "%")
                   .attr("x", padding + 75)
                   .attr("y", 0.85 * h + 30)
                   .attr("text-anchor", "middle"); 
                   
               var npv = svg.append("g")
                             .attr("class", "info");
               npv.append("text")
                   .text("NPV")
                   .attr("x", padding + 150 + padding + 75)
                   .attr("y", 0.85 * h - 15)
                   .attr("text-anchor", "middle");
               npv.append("rect")
                   .attr("x", padding + 150 + padding)
                   .attr("y", 0.85 * h);
               npv.append("text")
                   .text(Math.round(trueNeg / (trueNeg + falseNeg) * 100) + "%")
                   .attr("x", padding + 150 + padding + 75)
                   .attr("y", 0.85 * h + 30)
                   .attr("text-anchor", "middle");
               });
            }); 
            
        });
        
        })(window.d3);
      </script>


    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../assets/js/jquery.js"></script>
    <script src="../assets/js/bootstrap-transition.js"></script>
    <script src="../assets/js/bootstrap-alert.js"></script>
    <script src="../assets/js/bootstrap-modal.js"></script>
    <script src="../assets/js/bootstrap-dropdown.js"></script>
    <script src="../assets/js/bootstrap-scrollspy.js"></script>
    <script src="../assets/js/bootstrap-tab.js"></script>
    <script src="../assets/js/bootstrap-tooltip.js"></script>
    <script src="../assets/js/bootstrap-popover.js"></script>
    <script src="../assets/js/bootstrap-button.js"></script>
    <script src="../assets/js/bootstrap-collapse.js"></script>
    <script src="../assets/js/bootstrap-carousel.js"></script>
    <script src="../assets/js/bootstrap-typeahead.js"></script>

  </body>
</html>

